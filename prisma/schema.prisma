generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model course {
  id        Int       @id(map: "PK_course") @default(autoincrement()) @map("c_id")
  name      String    @map("c_name") @db.NVarChar(50)
  startDate DateTime  @map("c_start_date") @db.Date
  endDate   DateTime  @map("c_end_date") @db.Date
  form      Int       @map("c_form") @db.TinyInt
  subjects  subject[]

  @@index([name], map: "IX_course_name")
}

model group {
  id       Int             @id(map: "PK_group") @default(autoincrement()) @map("g_id")
  number   String          @map("g_number") @db.NVarChar(50)
  form     Int             @map("g_form") @db.TinyInt
  students student[]
  subjects subject_group[]

  @@index([number], map: "IX_group_number")
}

model lesson {
  id        String    @id(map: "PK_lesson") @map("l_id") @db.UniqueIdentifier
  startTime DateTime  @map("l_start_time") @db.DateTime
  endTime   DateTime  @map("l_end_time") @db.DateTime
  subjectId Int       @map("l_subject_id")
  location  String    @map("l_location") @db.NVarChar(15)
  teacherId String    @map("l_teacher_id") @db.UniqueIdentifier
  subject   subject   @relation(fields: [subjectId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_lesson_subject")
  user      user      @relation(fields: [teacherId], references: [id], onUpdate: NoAction, map: "FK_lesson_user")
  absences  absence[]
  grades    grade[]

  @@index([startTime, endTime], map: "IX_lesson_start_time_end_time")
  @@index([subjectId], map: "IX_lesson_subject_id")
}

model absence {
  studentId String  @map("lsa_student_id") @db.UniqueIdentifier
  lessonId  String  @map("lsa_lesson_id") @db.UniqueIdentifier
  hours     Int     @map("lsa_hours") @db.TinyInt
  lesson    lesson  @relation(fields: [lessonId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_lesson_student_absence_lesson")
  student   student @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_lesson_student_absence_student")

  @@id([studentId, lessonId], map: "PK_lesson_student_absence")
  @@map("lesson_student_absence")
}

model grade {
  studentId String  @map("lsg_student_id") @db.UniqueIdentifier
  lessonId  String  @map("lsg_lesson_id") @db.UniqueIdentifier
  value     Int     @map("lsg_grade_value") @db.TinyInt
  lesson    lesson  @relation(fields: [lessonId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_lesson_student_grade_lesson")
  student   student @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_lesson_student_grade_student")

  @@id([studentId, lessonId], map: "PK_lesson_student_grade")
  @@map("lesson_student_grade")
}

model student {
  id        String    @id(map: "PK_student") @map("s_id") @db.UniqueIdentifier
  userId    String    @map("s_user_id") @db.UniqueIdentifier
  groupId   Int       @map("s_group_id")
  isLeader  Boolean   @map("s_is_group_leader")
  isMarking Boolean   @map("s_is_marking")
  subgroup  Boolean   @map("s_subgroup")
  absences  absence[]
  grades    grade[]
  group     group     @relation(fields: [groupId], references: [id], onUpdate: NoAction, map: "FK_student_group")
  user      user      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_student_user")

  @@index([groupId], map: "IX_student_group")
  @@index([userId], map: "IX_student_user_id")
}

model subject {
  id            Int             @id(map: "PK_subject") @default(autoincrement()) @map("s_id")
  courseId      Int             @map("s_course_id")
  recurrenceIon String          @map("s_recurrence_json") @db.NVarChar(Max)
  teacherId     String          @map("s_teacher_id") @db.UniqueIdentifier
  typeId        Int             @map("s_type_id") @db.TinyInt
  lessons       lesson[]
  course        course          @relation(fields: [courseId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_subject_course")
  type          subject_type    @relation(fields: [typeId], references: [id], onUpdate: NoAction, map: "FK_subject_subject_type")
  teacher       user            @relation(fields: [teacherId], references: [id], onUpdate: NoAction, map: "FK_subject_user")
  groups        subject_group[]

  @@index([courseId], map: "IX_subject_course_id")
}

model subject_group {
  subjectId      Int      @map("sg_subject_id")
  groupId        Int      @map("sg_group_id")
  subgroupNumber Boolean? @map("sg_subgroup_number")
  group          group    @relation(fields: [groupId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_course_group_group")
  subject        subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_subject_group_subject")

  @@id([subjectId, groupId], map: "PK_subject_group")
}

model subject_type {
  id       Int       @id(map: "PK_course_type") @default(autoincrement()) @map("st_id") @db.TinyInt
  name     String    @map("st_name") @db.NVarChar(50)
  subjects subject[]
}

model sysdiagrams {
  name         String @db.NVarChar(128)
  principal_id Int
  diagram_id   Int    @id(map: "PK__sysdiagr__C2B05B61A5B298E1") @default(autoincrement())
  version      Int?
  definition   Bytes?

  @@unique([principal_id, name], map: "UK_principal_name")
}

model user {
  id         String    @id(map: "PK_user") @map("u_id") @db.UniqueIdentifier
  name       String    @map("u_name") @db.NVarChar(50)
  email      String    @unique(map: "IX_user_email") @map("u_email") @db.NVarChar(50)
  password   String?   @map("u_password") @db.NVarChar(255)
  roleId     Int       @map("u_role_id") @db.TinyInt
  surname    String    @map("u_surname") @db.NVarChar(50)
  patronymic String?   @map("u_patronymic") @db.NVarChar(50)
  rt         String?   @map("u_rt") @db.NVarChar(512)
  lessons    lesson[]
  students   student[]
  subjects   subject[]
  userRole   user_role @relation(fields: [roleId], references: [id], onUpdate: NoAction, map: "FK_user_user_role")

  @@index([surname, name], map: "IX_user_surname_name")
}

model user_role {
  id    Int    @id(map: "PK_user_role") @default(autoincrement()) @map("ur_id") @db.TinyInt
  name  String @map("ur_name") @db.NVarChar(50)
  users user[]
}
